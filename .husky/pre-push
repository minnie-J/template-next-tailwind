#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "\nPre-push Hook..."

# knip(ì‚¬ìš©í•˜ì§€ ì•Šì€ íŒŒì¼ ì²´í¬) ì‹¤í–‰
echo "\n>> ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” íŒŒì¼ì´ ìžˆëŠ”ì§€ ì²´í¬"

npm run knip

echo "\n>> íŒŒì¼ ì²´í¬ ë -> ëª©ë¡ì´ ìžˆë‹¤ë©´ í™•ì¸í•´ì£¼ì„¸ìš”!\n"

# ë³´í˜¸ ë¸Œëžœì¹˜ì— í‘¸ì‹œí•˜ê³  ìžˆëŠ”ì§€ ì—¬ë¶€ ì²´í¬
# echo "\n>> Checking branch name\n"
echo "\n>> ë³´í˜¸ ë¸Œëžœì¹˜ì— pushì¤‘ì¸ì§€ í™•ì¸\n"

# í˜„ìž¬ ì²´í¬ì•„ì›ƒëœ ë¸Œëžœì¹˜
CURRENT_BRANCH=$(git rev-parse --abbrev-ref HEAD)
# ì§ì ‘ pushí•˜ë©´ ì•ˆë˜ëŠ” ë³´í˜¸ ë¸Œëžœì¹˜
PROTECTED_BRANCHES="main dev"

echo "ë³´í˜¸ ë¸Œëžœì¹˜(ë“¤): $PROTECTED_BRANCHES"
echo "í˜„ìž¬ ë¸Œëžœì¹˜: $CURRENT_BRANCH\n"

for BRANCH in $PROTECTED_BRANCHES
do
  # í˜„ìž¬ ë¸Œëžœì¹˜ê°€ ë³´í˜¸ ë¸Œëžœì¹˜ë©´ push ì·¨ì†Œ ì²˜ë¦¬
  if [ "$BRANCH" = "$CURRENT_BRANCH" ]
  then
    echo "ðŸš« ë³´í˜¸ ë¸Œëžœì¹˜ì— ì§ì ‘ pushí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
    echo "ðŸš« ì‹ ê·œ ë¸Œëžœì¹˜ë¡œë¶€í„° pushí•œ í›„ PRí•´ì£¼ì„¸ìš”!\n"
    exit 1
    break
  fi
done

# echo ">> Finish checking branch name.\n"
echo ">> ì•ˆì „í•˜ê²Œ pushì¤‘! ^.^/\n"

exit 0
